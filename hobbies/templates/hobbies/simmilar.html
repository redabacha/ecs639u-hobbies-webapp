<link
  rel="stylesheet"
  href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
  integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T"
  crossorigin="anonymous"
/>
<script src="https://cdn.jsdelivr.net/npm/vue@2"></script>

{% if user.is_authenticated %} {% block contents %}
<div id="app" class="container-fluid">
  {% csrf_token %}
  <div style="margin-top: 10px">
    <a>Filter by City: </a><input v-model="filterValueCity" v-on:keyup.enter="filterCity" placeholder="Press enter to filter"></input>
  </div>
  <div style="margin-top: 10px; float right">
    <a>Filter by age: </a><input v-on:keyup.enter="filterAge" v-model="filterAgeMin" style="text-align: center; margin-right: 10px; width:40px;"></input><input v-on:keyup.enter="filterAge" v-model="filterAgeMax" style="text-align: center;  margin-right: 10px; width:40px;"></input>
  </div>
  <table class="table" style="margin-top: 10px;">
    <thead>
      <tr>
        <th scope="col">#</th>
        <th scope="col">Name</th>
        <th scope="col">Email</th>
        <th scope="col">City</th>
        <th scope="col">Age</th>
        <th scope="col">Common Hobbies (#)</th>
      </tr>
    </thead>
    <tbody>
      <tr v-for="user in filteredUsers">
        <th scope="row">[[user.id]]</th>
        <td>[[user.username]]</td>
        <td>[[user.email]]</td>
        <td>[[user.city]]</td>
        <td>[[user.age]]</td>
        <td>[[user.common]]</td>
      </tr>
    </tbody>
  </table>
</div>
{%endblock%} {% endif %} {% block scripts %}
<script src="https://cdn.jsdelivr.net/npm/vue@2.6.14"></script>
<script>
  let myApp = new Vue({
    el: "#app",
    delimiters: ["[[", "]]"],
    data() {
      return {
        users: [],
        filteredUsers: [],
        filterValueCity: "",
        filterAgeMin: 0,
        filterAgeMax: 150
      };
    },
    async created() {
      let response = await fetch(`{% url 'users hobbies api' user.id%}`, {
        method: "GET",
      });
      if (response.ok) {
        let data = await response.json();
        this.$data.users = data.users;
        this.$data.filteredUsers = data.users;
      }
    },
    methods: {
        async filterCity() {
            users = this.$data.users;
            filterValueCity = this.$data.filterValueCity;
            if(filterValueCity == ""){
                this.$data.filteredUsers = users;
                return;
            }
            this.$data.filteredUsers = users.filter(function(user) {
                return user.city == filterValueCity
            });
        },

        async filterAge(){
            users = this.$data.users;
            filterMin = this.$data.filterAgeMin;
            filterMax = this.$data.filterAgeMax;
            if(filterMin == ""){
                this.$data.filterMin = 0;
            }
            if(filterMax == ""){
                this.$data.filterMax = 150;
            }
            this.$data.filteredUsers = users.filter(function(user) {
                return user.age >= filterMin && user.age <= filterMax;
            });
        }
    },
  });
</script>
{% endblock %}
